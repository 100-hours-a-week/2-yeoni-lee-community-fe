<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="3_memo_list.css">
    <title>게시물 목록 조회</title>
</head>
<body>
    <section class="wrap">
        <h1 class="name">아무 말 대잔치</h1>
        <hr class="horizontal-rule"/>
        <h1 class="page_title">게시글 목록</h1>

        <!-- 드롭다운 메뉴 -->
        <div class="dropdown">
            <button class="dropbtn"> 
                <span class="dropbtn_icon">profile-pic</span>
            </button>
            <div class="dropdown-content">
                <button class="menu" id="log_out_btn">로그아웃</button>
                <button class="menu" id="mod_my_btn">내 정보 수정</button>
            </div>
        </div>

        <!-- 게시물 작성 버튼 -->
        <div class="buttons">
            <button class="menu" id="write_memo">게시물 작성</button>
        </div>
        
        <!-- 안내 문구 -->
        <h2 class="name">안녕하세요, 아무 말 대잔치 게시판입니다.</h2>

        <!-- 게시물 목록 -->
        <div id="memo-list"></div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const memoList = document.getElementById('memo-list');

            // 게시물 목록 가져오기
            try {
                const response = await fetch('/api/memo_list');
                if (!response.ok) throw new Error('Failed to fetch memo list');

                const memos = await response.json();
                memoList.innerHTML = ''; // 기존 내용 비우기

                // 게시물 렌더링
                memos.forEach((memo) => {
                    const memoElement = document.createElement('div');
                    memoElement.classList.add('memo');
                    memoElement.innerHTML = `
                        <h2 class="post-title">${memo.title}</h2>
                        <div class="post-stats">
                            <span class="stat">좋아요: ${memo.likes}</span>
                            <span class="stat">댓글: ${memo.comments}</span>
                            <span class="stat">조회수: ${memo.views}</span>
                            <span class="stat time">${memo.createdAt}</span>
                        </div>
                        <hr class="horizontal-rule" />
                        <div class="author">
                            <div class="profile-pic"></div>
                            <span class="author-name">${memo.author}</span>
                        </div>
                    `;
                    memoList.appendChild(memoElement);
                });
            } catch (error) {
                console.error('Error fetching memo list:', error);
                memoList.innerHTML = '<p>게시물을 불러오는 데 실패했습니다.</p>';
            }
        });

        // 버튼 클릭 이벤트 처리
        document.getElementById('log_out_btn').addEventListener('click', async () => {
            try {
                const response = await fetch('/logout', { method: 'POST' });
                if (response.ok) {
                    alert('로그아웃되었습니다.');
                    window.location.href = '/login';
                } else {
                    alert('로그아웃에 실패했습니다.');
                }
            } catch (error) {
                console.error('로그아웃 중 오류:', error);
            }
        });

        document.getElementById('mod_my_btn').addEventListener('click', () => {
            window.location.href = '/my_info';
        });

        document.getElementById('write_memo').addEventListener('click', () => {
            window.location.href = '/add_memo';
        });
    </script>
</body>
</html>
