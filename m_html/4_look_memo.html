<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="4_look_memo.css">
    <title>ê²Œì‹œë¬¼ ìƒì„¸ë³´ê¸°</title>
</head>
<body> 
    <section class="wrap">
    <h1 class="name" id="header-title">ì•„ë¬´ ë§ ëŒ€ì”ì¹˜</h1>
    <hr class="horizontal-rule"/>
    <h1 class="page_title">ê²Œì‹œê¸€ ë³´ê¸°</h1>
    <div class="dropdown">
        <button class="dropbtn"> 
            <img id="dropdown-profile-pic" class="dropbtn_icon" alt="í”„ë¡œí•„ ì‚¬ì§„" src="default-profile.jpg" />
        </button>
        <div class="dropdown-content">
            <button class="menu" id="log_out_btn">ë¡œê·¸ì•„ì›ƒ</button>
            <button class="menu" id="mod_my_btn">ë‚´ ì •ë³´ ìˆ˜ì •</button>
        </div>
    </div>
    <!-- ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ -->
    <div class="action-buttons">
        <button id="edit-memo" class="edit">ìˆ˜ì •</button>
        <button id="delete-memo" class="delete">ì‚­ì œ</button>
    </div>

   <!-- ê²Œì‹œë¬¼ ì‚­ì œ ëª¨ë‹¬ -->
    <div id="memo-delete-modal" class="modal hidden">
        <div class="modal-content">
            <p>ì •ë§ë¡œ ê²Œì‹œë¬¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <div class="modal-buttons">
                <button id="confirm-memo-delete" class="modal-confirm">í™•ì¸</button>
                <button id="cancel-memo-delete" class="modal-cancel">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ê²Œì‹œë¬¼ ë³¸ë¬¸ -->
    <article class="post">
        <h2 class="post-title" id="post-title">ì œëª©</h2>
        <div class="post-info">
            <span class="username" id="username">ì‘ì„±ì</span>
            <span class="time" id="time">ì‘ì„± ì‹œê°„</span>
        </div>
        <hr class="horizontal-rule" />
        <div class="image-container" id="image-container">
            <img id="memo-img" src="" alt="ê²Œì‹œë¬¼ ì´ë¯¸ì§€">
        </div>
        <p class="context" id="context">ë‚´ìš©</p>
        <div class="like-section">
            <div class="like-button">
                ì¢‹ì•„ìš”ìˆ˜<span id="like-count">0</span>
            </div>
            <div class="view-button">
                ì¡°íšŒìˆ˜<span id="view-count">0</span>
            </div>
            <div class="comment-button">
                ëŒ“ê¸€<span id="comment-count">0</span>
            </div>
        </div>
    </article>

    <!-- ëŒ“ê¸€ ì…ë ¥ -->
    <article class="write_comment">
        <input type="text" id="comment-text" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.">
        <button id="submit-comment">ëŒ“ê¸€ ì‘ì„±</button>
    </article>

    <!-- ëŒ“ê¸€ ëª©ë¡ -->
    <article class="comment_box" id="comment-box">
        <!-- ëŒ“ê¸€ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
    </article>
    <!-- ëŒ“ê¸€ ì‚­ì œ ëª¨ë‹¬ -->
    <div id="comment-delete-modal" class="modal hidden">
        <div class="modal-content">
            <p>ì •ë§ë¡œ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <div class="modal-buttons">
                <button id="confirm-comment-delete" class="modal-confirm">í™•ì¸</button>
                <button id="cancel-comment-delete" class="modal-cancel">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>
</section>
    <script>
        let isEditMode = false; // ìˆ˜ì • ëª¨ë“œ ìƒíƒœë¥¼ ì¶”ì 
        let currentEditingCommentId = null; // ìˆ˜ì • ì¤‘ì¸ ëŒ“ê¸€ ID
        let currentCommentId = null; // ì‚­ì œí•  ëŒ“ê¸€ ID ì €ì¥



        const API_BASE_URL = '/api';  
        //const API_BASE_URL = 'http://3.34.144.209:5000';
        // ë‚´ ì •ë³´ ë³´ê¸° ë²„íŠ¼ í´ë¦­
        document.getElementById('mod_my_btn').addEventListener('click', () => {
                window.location.href = '/7_my_info';
        });
        // ë²„íŠ¼ ë™ì‘: ë©”ì¸í™”ë©´
        document.getElementById('header-title').addEventListener('click', () => {
            window.location.href = '/3_memo_list.html';
        });
        
            // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­
        document.getElementById('log_out_btn').addEventListener('click', () => {
                window.location.href = '/2_login';
        });

        async function loadUserInfo() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/check_session`, {
                    credentials: 'include',
                });
                if (!response.ok) {
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    window.location.href = '/2_login.html';
                    return;
                }

                const { user } = await response.json();

                // í”„ë¡œí•„ ì‚¬ì§„ ì—…ë°ì´íŠ¸
                const dropdownProfilePic = document.getElementById("dropdown-profile-pic");
                dropdownProfilePic.src = user.img ? `${API_BASE_URL}${user.img}` : 'default-profile.jpg'; // ì„¸ì…˜ì—ì„œ ì´ë¯¸ì§€ ê²½ë¡œ ê°€ì ¸ì˜¤ê¸°
            } catch (err) {
                console.error("ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", err);
            }
        }

        document.addEventListener("DOMContentLoaded", async () => {  
        const { id } = getQueryParams();
        if (sessionStorage.getItem(`viewed_${id}`) !== "true") {
        await increaseViewCount(id);
        sessionStorage.setItem(`viewed_${id}`, "true");
        }

        loadUserInfo();

        const editButton = document.getElementById("edit-memo"); // ìˆ˜ì • ë²„íŠ¼
        const deleteButton = document.getElementById("delete-memo"); // ì‚­ì œ ë²„íŠ¼
        const memoModal = document.getElementById("memo-delete-modal");
        const confirmMemoDelete = document.getElementById("confirm-memo-delete");
        const cancelMemoDelete = document.getElementById("cancel-memo-delete");
        
        
        await renderMemoDetail();    // ê²Œì‹œë¬¼ ë°ì´í„° ë Œë”ë§

        const response = await fetch(`${API_BASE_URL}/api/look_memo?id=${encodeURIComponent(id)}`);
        if (!response.ok) throw new Error("Failed to fetch memo");

        const memo = await response.json(); // memo ì •ì˜

        const likeButton = document.querySelector(".like-button"); //ì¢‹ì•„ìš”ë²„íŠ¼
        const submitCommentButton = document.getElementById("submit-comment"); //ëŒ“ê¸€ ì‘ì„± ë²„íŠ¼
        submitCommentButton.addEventListener("click", handleCommentAction);
        const commentBox = document.getElementById("comment-box"); //ëŒ“ê¸€ ë°•ìŠ¤
        const commentText = document.getElementById("comment-text"); //ëŒ“ê¸€ ë‚´ìš©
        const likeCountSpan = document.getElementById("like-count"); //ì¢‹ì•„ìš”ìˆ˜ 
        const viewCountSpan = document.getElementById("view-count");// ì¡°íšŒìˆ˜ 
        const commentCountSpan = document.getElementById("comment-count"); //ëŒ“ê¸€ ìˆ˜
        // ëŒ“ê¸€ ì‚­ì œ ê´€ë ¨
        const commentModal = document.getElementById("comment-delete-modal");
        const confirmCommentDelete = document.getElementById("confirm-comment-delete");
        const cancelCommentDelete = document.getElementById("cancel-comment-delete");
        
        let hasLiked = false; // ì¢‹ì•„ìš” ìƒíƒœ

        // ê²Œì‹œë¬¼ ë°ì´í„° ë¡œë“œ ë° ë Œë”ë§
        await renderMemoDetail();

        // ê²Œì‹œë¬¼ ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        if (editButton) {
            editButton.addEventListener("click", () => {
                const { id } = getQueryParams();
                window.location.href = `/5_mod_memo?id=${id}`;
            });
        }


        /////ëª¨ë‹¬//////
        //////ëª¨ë‹¬//////

        // ê²Œì‹œë¬¼ ì‚­ì œ ë²„íŠ¼
        document.getElementById("delete-memo").addEventListener("click", () => {
            memoModal.classList.add("show");
        });

        // ê²Œì‹œë¬¼ ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        if (deleteButton) {
            confirmMemoDelete.addEventListener("click", async () => {
                const { id } = getQueryParams();
                try {
                    const response = await fetch(`${API_BASE_URL}/delete_memo`, {
                        method: "DELETE",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ id }),
                        credentials: 'include',
                    });

                    if (response.ok) {
                        window.location.href = '/3_memo_list.html';
                    } else {
                        const error = await response.json();
                        alert(`ê²Œì‹œê¸€ ì‚­ì œ ì‹¤íŒ¨: ${errorData.error}`);
                    }
                } catch (err) {
                    console.error("ê²Œì‹œë¬¼ ì‚­ì œ ì˜¤ë¥˜:", err);
                }finally {
                    modal.classList.remove("show");
                }
            });
        }

    // ê²Œì‹œë¬¼ ì‚­ì œ ì·¨ì†Œ
    cancelMemoDelete.addEventListener("click", () => {
        memoModal.classList.remove("show");
    });
        

    // ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    document.querySelector(".like-button").addEventListener("click", async () => {
        const { id } = getQueryParams(); // URLì—ì„œ ê²Œì‹œë¬¼ ID ê°€ì ¸ì˜¤ê¸°

        try {
            const response = await fetch(`${API_BASE_URL}/like_memo`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id }),
            credentials: 'include',
            });

            if (response.ok) {
            const { like, hasLiked } = await response.json();
            document.getElementById("like-count").textContent = like; // ì¢‹ì•„ìš” ìˆ˜ ì—…ë°ì´íŠ¸
            likeButton.classList.toggle("liked", hasLiked);
        } else {
            const error = await response.json();
            alert(error.error || "ì¢‹ì•„ìš” ì²˜ë¦¬ ì‹¤íŒ¨");
            }
        } catch (err) {
            console.error("ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:", err);
        }
    });


    function resetCommentForm() {
        document.getElementById("comment-text").value = "";
        submitCommentButton.textContent = "ëŒ“ê¸€ ì‘ì„±";
        isEditMode = false;
        currentEditingCommentId = null;
    }

    const updateCommentCount = async (memoId) => {
        try {
            const response = await fetch(`${API_BASE_URL}/api/look_memo?id=${encodeURIComponent(memoId)}`);
            if (response.ok) {
                const memo = await response.json();
                document.getElementById("comment-count").textContent = memo.commentCount || 0;
            }
        } catch (error) {
            console.error("ëŒ“ê¸€ ìˆ˜ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:", error);
        }
    };

    submitCommentButton.addEventListener("click", async () => {
        // ê¸°ì¡´ ì¶”ê°€ í›„ í˜¸ì¶œ
        await updateCommentCount(id);
    });


    // ê²Œì‹œë¬¼ ìƒì„¸ ë°ì´í„°ë¥¼ ë Œë”ë§
    async function renderMemoDetail() {
        const { id } = getQueryParams();

        try {            
            const response = await fetch(`${API_BASE_URL}/api/look_memo?id=${encodeURIComponent(id)}`);
            if (!response.ok) throw new Error("ê²Œì‹œë¬¼ ë¡œë”© ì‹¤íŒ¨");

            const { memo, comments } = await response.json();
            const commentCount = memo.commentCount !== undefined ? memo.commentCount : comments.length;
            //í˜„ì¬ ì‚¬ìš©ì 
            const currentUser = await fetch(`${API_BASE_URL}/api/check_session`, {
                credentials: 'include', // ì„¸ì…˜ ì¿ í‚¤ë¥¼ í¬í•¨
            })
                .then((res) => res.json())
                .catch(() => ({ user: null }));
                            
            document.getElementById("post-title").textContent = memo.title || "ì œëª© ì—†ìŒ";
            document.getElementById("username").textContent = memo.username || "ìµëª…";
            document.getElementById("time").textContent = memo.time || "0000-00-00 00:00:00";
            document.getElementById("context").textContent = memo.context || "ë‚´ìš© ì—†ìŒ";
            
            const imgElement = document.getElementById("memo-img");
            if (memo.img) {
                imgElement.src = `${API_BASE_URL}${memo.img}`;
            }
            else document.getElementById("image-container").style.display = "none";

            document.getElementById("like-count").textContent = memo.like || 0;
            document.getElementById("view-count").textContent = memo.view || 0;
            document.getElementById("comment-count").textContent = memo.commentCount || 0;

            // ì‘ì„±ìê°€ ì•„ë‹Œ ê²½ìš° ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ ìˆ¨ê¹€
            if (currentUser.user?.nickname !== memo.username) {
                editButton.style.display = "none";
                deleteButton.style.display = "none";
            }
            const likeButton = document.querySelector(".like-button");
            if (memo.hasLiked) {
                likeButton.classList.add("liked"); // ì¢‹ì•„ìš” í‘œì‹œ
            } else {
                likeButton.classList.remove("liked");
            }
            // âœ… ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ëŒ“ê¸€ ê°œìˆ˜ ë³´ì • (ìµœì¢…ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸)
        
            document.getElementById("comment-count").textContent = commentCount;
            //renderComments(memo.comments || []);
            renderComments(comments);

        } catch (err) {
            console.error("ê²Œì‹œë¬¼ ë Œë”ë§ ì‹¤íŒ¨:", err);
            alert("ê²Œì‹œë¬¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
        }
    }

    ///ì¡°íšŒìˆ˜ ì¦ê°€////
    async function increaseViewCount(id) {
        try {
            await fetch(`${API_BASE_URL}/increase_view?id=${encodeURIComponent(id)}`);
        } catch (err) {
            console.error("ì¡°íšŒìˆ˜ ì¦ê°€ ì‹¤íŒ¨:", err);
        }
    }

    // í˜¸ì¶œ
    document.addEventListener("DOMContentLoaded", async () => {
        const { id } = getQueryParams();
        //increaseViewCount(id); // ì¡°íšŒìˆ˜ ì¦ê°€
        await renderMemoDetail();
    });
    
    // ëŒ“ê¸€ ì‘ì„±/ìˆ˜ì • í•¸ë“¤ëŸ¬
    async function handleCommentAction() {
        const commentText = document.getElementById("comment-text");
        const commentTextValue = commentText.value.trim();
        const commentCountSpan = document.getElementById("comment-count");
        const { id: memoId } = getQueryParams();

        if (!commentTextValue) {
            alert("ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        try {
            let response;
            if (isEditMode) {
                // ëŒ“ê¸€ ìˆ˜ì • ìš”ì²­
                response = await fetch(`${API_BASE_URL}/edit_comment`, {
                    method: "PATCH",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ commentId: currentEditingCommentId, text: commentTextValue }),
                    credentials: 'include',
                });
            } else {
                // ëŒ“ê¸€ ì¶”ê°€ ìš”ì²­
                response = await fetch(`${API_BASE_URL}/add_comment`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ memoId, text: commentTextValue }),
                    credentials: 'include',
                });
            }

            if (response.ok) {
                const { comments, commentCount } = await response.json(); // âœ… ì„œë²„ì—ì„œ ìµœì‹  ëŒ“ê¸€ ëª©ë¡ê³¼ ê°œìˆ˜ ê°€ì ¸ì˜¤ê¸°
                let currentCount = parseInt(commentCountSpan.textContent, 10) || 0;
                commentCountSpan.textContent = currentCount + 1;


                renderComments(comments); // ëŒ“ê¸€ ë Œë”ë§
                resetCommentForm(); // í¼ ìƒíƒœ ì´ˆê¸°í™”
            } else {
                alert("ëŒ“ê¸€ ì²˜ë¦¬ ì‹¤íŒ¨");
            }
        } catch (err) {
            console.error("ëŒ“ê¸€ ì²˜ë¦¬ ì˜¤ë¥˜:", err);
        }
}
    // ëŒ“ê¸€ ë Œë”ë§ í•¨ìˆ˜
    async function renderComments(comments) {
        const commentBox = document.getElementById("comment-box");
        const commentCountSpan = document.getElementById("comment-count");

        commentBox.innerHTML = ""; // ê¸°ì¡´ ëŒ“ê¸€ ì´ˆê¸°í™”

        if (!Array.isArray(comments) || comments.length === 0) {
            commentBox.innerHTML = "<p>ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
            document.getElementById("comment-count").textContent = "0";
            return;
        }
        // âœ… ì„œë²„ì—ì„œ ë°›ì€ ìµœì‹  ëŒ“ê¸€ ê°œìˆ˜ë¡œ ì—…ë°ì´íŠ¸
        commentCountSpan.textContent = comments.length;
        // âœ… í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        let currentUser = null;
        try {
            const currentUserResponse = await fetch(`${API_BASE_URL}/api/check_session`, {
                credentials: 'include',
            });

            if (currentUserResponse.ok) {
                const currentUserData = await currentUserResponse.json();
                currentUser = currentUserData.user?.nickname || null;
            }
        } catch (error) {
            console.error("í˜„ì¬ ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
        }

        comments.forEach((comment) => {         
            const commentDiv = document.createElement("div");
            commentDiv.classList.add("comment");

            // âœ… í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ëŒ“ê¸€ ì‘ì„±ìì¸ ê²½ìš°ë§Œ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ ë³´ì´ê¸°
            const isOwner = currentUser === comment.username; // ë¹„êµ ë¡œì§ ìˆ˜ì •
            const editButtonHTML = isOwner ? `<button class="edit-comment" data-id="${comment.id}" data-text="${comment.text}">ìˆ˜ì •</button>` : "";
            const deleteButtonHTML = isOwner ? `<button class="delete-comment" data-id="${comment.id}">ì‚­ì œ</button>` : "";

            commentDiv.innerHTML = `
                <p><strong>${comment.username}</strong>: ${comment.text}</p>
                <small>${new Date(comment.createdAt).toLocaleString()}</small>
                ${editButtonHTML}
                ${deleteButtonHTML}
            `;

            commentBox.appendChild(commentDiv);
        });

        // âœ… ìˆ˜ì • ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡ (ë‚´ê°€ ì“´ ëŒ“ê¸€ì—ë§Œ ì ìš©)
        document.querySelectorAll(".edit-comment").forEach((btn) => {
            btn.addEventListener("click", handleEditComment);
        });

        // âœ… ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡ (ë‚´ê°€ ì“´ ëŒ“ê¸€ì—ë§Œ ì ìš©)
        document.querySelectorAll(".delete-comment").forEach((btn) => {
            btn.addEventListener("click", (event) => {
                currentCommentId = event.target.dataset.id;
                const commentModal = document.getElementById("comment-delete-modal");
                commentModal.classList.add("show");
            });
        });
}

// ëŒ“ê¸€ ì‘ì„± í¼ ì´ˆê¸°í™”
function resetCommentForm() {
    const commentText = document.getElementById("comment-text");
    const submitCommentButton = document.getElementById("submit-comment");

    commentText.value = ""; // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
    submitCommentButton.textContent = "ëŒ“ê¸€ ì‘ì„±";
    isEditMode = false; // ìˆ˜ì • ëª¨ë“œ í•´ì œ
    currentEditingCommentId = null;
}

// ëŒ“ê¸€ ìˆ˜ì • í•¸ë“¤ëŸ¬
async function handleEditComment(event) {
    const commentText = document.getElementById("comment-text");
    const submitCommentButton = document.getElementById("submit-comment");

    currentEditingCommentId = event.target.dataset.id; // ìˆ˜ì •í•  ëŒ“ê¸€ ID ì„¤ì •
    const oldText = event.target.dataset.text;

    commentText.value = oldText; // ê¸°ì¡´ í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œì— ì‚½ì…
    submitCommentButton.textContent = "ìˆ˜ì • ì™„ë£Œ"; // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
    isEditMode = true; // ìˆ˜ì • ëª¨ë“œ í™œì„±í™”
}

// ëŒ“ê¸€ ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°

    document.addEventListener("click", (event) => {
        if (event.target.classList.contains("delete-comment")) {
            currentCommentId = event.target.dataset.id; // ëŒ“ê¸€ ID ì €ì¥
            commentModal.classList.add("show");
        }
    });

    async function deleteComment(commentId) {
        const { id: memoId } = getQueryParams();
        const commentCountSpan = document.getElementById("comment-count");

        try {
            const response = await fetch(`${API_BASE_URL}/delete_comment`, {
                method: "DELETE",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ commentId, memoId }),
                credentials: "include",
            });

            if (response.ok) {
                const { comments } = await response.json();
                renderComments(comments);

                // ğŸ”¹ UIì—ì„œ ì¦‰ì‹œ ëŒ“ê¸€ ê°œìˆ˜ ê°ì†Œ
                let currentCount = parseInt(commentCountSpan.textContent, 10) || 0;
                commentCountSpan.textContent = Math.max(0, currentCount - 1); // ìµœì†Œ 0 ìœ ì§€
            } else {
                alert("ëŒ“ê¸€ ì‚­ì œ ì‹¤íŒ¨");
            }
        } catch (err) {
            console.error("ëŒ“ê¸€ ì‚­ì œ ì˜¤ë¥˜:", err);
        }
    }


    // ëŒ“ê¸€ ì‚­ì œ í™•ì¸
    document.getElementById("confirm-comment-delete").addEventListener("click", async () => {
        const { id: memoId } = getQueryParams();

        try {
            const response = await fetch(`${API_BASE_URL}/delete_comment`, {
                method: "DELETE",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ commentId: currentCommentId, memoId }),
                credentials: "include",
            });

            if (response.ok) {
                const { comments } = await response.json();
                renderComments(comments); // ëŒ“ê¸€ ëª©ë¡ ê°±ì‹ 
                document.getElementById("comment-count").textContent = comments.length;
            } else {
                alert("ëŒ“ê¸€ ì‚­ì œ ì‹¤íŒ¨");
            }
        } catch (err) {
            console.error("ëŒ“ê¸€ ì‚­ì œ ì˜¤ë¥˜:", err);
        } finally {
            const commentModal = document.getElementById("comment-delete-modal");
            commentModal.classList.remove("show");
        }
    });

    // ëŒ“ê¸€ ì‚­ì œ ì·¨ì†Œ
    cancelCommentDelete.addEventListener("click", () => {
        commentModal.classList.remove("show");
    });


    // URL íŒŒë¼ë¯¸í„° ì¶”ì¶œ
    function getQueryParams() {
        const params = new URLSearchParams(window.location.search);
        return { id: params.get("id") };
    }
});

    </script>
</body>
</html>